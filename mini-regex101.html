<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini RegExp101</title>
    <style>
      .regexp101-main #regexpInput {
        width: 500px;
      }
      .regexp101-main #stringInput,
      .regexp101-main #result {
        width: 500px;
        height: 200px;
      }
      #regexpInput,
      #stringInput,
      #result {
        box-sizing: border-box;
        padding: 0.5em;
        border: 2px solid;
        border-radius: 0.5em;
        margin: 0.3em;
        font-size: 1.5em;
        font-family: consolas;
        outline: none;
      }
      #stringInput {
        background-color: transparent;
      }
      label[for="regexpInput"],
      label[for="stringInput"] {
        font-size: 1.5em;
        margin: 0.3em;
      }
      .regexpOptions {
        box-sizing: border-box;
        font-size: 1.5em;
        margin: 0.3em;
      }
      .regexpOptions input {
        margin-left: 0;
      }
      #result span {
        background-color: #d5ebff;
        font-weight: bold;
      }
      #result span:nth-child(even) {
        background-color: #9fcfff;
        font-weight: bold;
      }
      #result span:empty {
        display: inline-block;
        width: 2px;
        height: 1em;
        margin-left: -1px;
        margin-right: -1px;
        background-image: linear-gradient(red, red);
      }
      #showoff {
        position: relative;
      }
      #result {
        z-index: -1;
        white-space: pre-wrap;
      }
      #stringInput,
      #result {
        line-height: 1.5;
        overflow: scroll;
        white-space: normal;
      }
    </style>
  </head>
  <body>
    <h1>Mini Regex 101</h1>
    <div class="regexp101-main">
      <div class="regexpOptions">
        <input checked type="checkbox" name="global" id="g" />
        <label for="g">g</label>
        <input checked type="checkbox" name="multi-line" id="m" />
        <label for="m">m</label>
        <input type="checkbox" name="insensitive" id="i" />
        <label for="i">i</label>
        <input type="checkbox" name="sticky" id="y" />
        <label for="y">y</label>
        <input type="checkbox" name="unicode" id="u" />
        <label for="u">u</label>
        <input type="checkbox" name="single-line" id="s" />
        <label for="s">s</label>
        <input type="checkbox" name="indices" id="d" />
        <label for="d">d</label>
        <span id="info"></span>
      </div>
      <label for="regexpInput">Regular Expressions</label>
      <br />
      <input type="text" id="regexpInput" oninput="run()" />
      <br />
      <label for="stringInput">Test String</label>
      <br />
      <div id="showoff">
        <textarea
          onscroll="同步滚动条()"
          oninput="run()"
          name=""
          id="stringInput"
          cols="30"
          rows="10"
          spellcheck="false"
        ></textarea>
        <pre id="result"></pre>
      </div>
    </div>
    <script>
      run();
      function run() {
        const reStr = regexpInput.value;
        const text = stringInput.value;
        if (reStr === "") {
          result.innerHTML = text;
          info.innerHTML = "";
        } else if (reStr !== "") {
          let re;
          try {
            re = new RegExp(reStr, "g");
          } catch (e) {
            info.innerHTML = "正则表达式错误";
            return;
          }
          info.innerHTML = "";
          let html = "";
          let match = null;
          let lastIndex = 0;

          while ((match = re.exec(text))) {
            html += text.slice(lastIndex, match.index);
            html += "<span>" + match[0] + "</span>";
            lastIndex = re.lastIndex;
            if (match[0].length === 0) {
              re.lastIndex++;
            }
          }

          html += text.slice(lastIndex);
          if (html === "<span></span>") {
            html = "";
          }
          result.innerHTML = html;
        }
      }

      function 同步滚动条() {
        result.scrollTo(stringInput.scrollLeft, stringInput.scrollTop);
      }
    </script>
  </body>
</html>
